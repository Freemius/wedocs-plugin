Vue.directive("sortable",{bind:function(){var e=jQuery(this.el);e.sortable({handle:".wedocs-btn-reorder",stop:function(e,t){var o=[];jQuery(t.item.closest("ul")).children("li").each(function(e,t){o.push(jQuery(t).data("id"))}),wp.ajax.post({action:"wedocs_sortable_docs",ids:o,_wpnonce:weDocs.nonce})},cursor:"move"})}}),Vue.directive("sortable-faq",{bind:function(){var e=jQuery(this.el),t={_wpnonce:weDocs.nonce},o="category"===e.data("type");t.action=o?"wedocs_sortable_category":"wedocs_sortable_faq",e.sortable({handle:".wedocs-btn-reorder",stop:function(e,n){var s=[];jQuery(n.item.closest("ul")).children("li").each(function(e,t){s.push(jQuery(t).data("id"))}),t.ids=s,o||(t.category_id=jQuery(n.item).closest("ul").parents("li").data("id")),wp.ajax.post(t)},cursor:"move"})}}),new Vue({el:"#wedocs-app",data:{editurl:"",categoryEditUrl:"",viewurl:"",docs:[],categories:[]},ready:function(){var e=this,t=jQuery(e.$el);this.editurl=weDocs.editurl,this.categoryEditUrl=weDocs.categoryEditUrl,this.viewurl=weDocs.viewurl,t.find("ul.docs").removeClass("not-loaded").addClass("loaded");var o=0<window.location.search.indexOf("page=wedocs-faq"),n=o?"wedocs_admin_get_faq":"wedocs_admin_get_docs";jQuery.get(ajaxurl,{action:n,_wpnonce:weDocs.nonce},function(n){t.find(".spinner").remove(),t.find(".no-docs").removeClass("not-loaded"),o?e.categories=n.data:e.docs=n.data})},methods:{onError:function(e){alert(e)},addDoc:function(){var e=this;this.docs=this.docs||[],swal({title:weDocs.enter_doc_title,type:"input",showCancelButton:!0,closeOnConfirm:!0,animation:"slide-from-top",inputPlaceholder:weDocs.write_something},function(t){return t===!1?!1:(wp.ajax.send({data:{action:"wedocs_create_doc",title:t,parent:0,_wpnonce:weDocs.nonce},success:function(t){e.docs.unshift(t)},error:this.onError}),void 0)})},removeDoc:function(e,t){var o=this;swal({title:"Are you sure?",text:"Are you sure to delete the entire documentation? Sections and articles inside this doc will be deleted too!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){o.removePost(e,t)})},addSection:function(e){swal({title:weDocs.enter_section_title,type:"input",showCancelButton:!0,closeOnConfirm:!0,animation:"slide-from-top",inputPlaceholder:weDocs.write_something},function(t){return t===!1?!1:(t=t.trim(),t&&wp.ajax.send({data:{action:"wedocs_create_doc",title:t,parent:e.post.id,order:e.child.length,_wpnonce:weDocs.nonce},success:function(t){e.child.push(t)},error:this.onError}),void 0)})},removeSection:function(e,t){var o=this;swal({title:"Are you sure?",text:"Are you sure to delete the entire section? Articles inside this section will be deleted too!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){o.removePost(e,t)})},addArticle:function(e,t){var o=t;swal({title:weDocs.enter_doc_title,type:"input",showCancelButton:!0,closeOnConfirm:!0,animation:"slide-from-top",inputPlaceholder:weDocs.write_something},function(t){return t===!1?!1:(wp.ajax.send({data:{action:"wedocs_create_doc",title:t,parent:e.post.id,status:"draft",order:e.child.length,_wpnonce:weDocs.nonce},success:function(t){e.child.push(t);var n=jQuery(o.target).closest(".section-title").next();n.hasClass("collapsed")&&n.removeClass("collapsed")},error:function(e){alert(e)}}),void 0)})},removeArticle:function(e,t){var o=this;swal({title:"Are you sure?",text:"Are you sure to delete the article?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){o.removePost(e,t)})},removePost:function(e,t,o){o=o||"This post has been deleted",wp.ajax.send({data:{action:"wedocs_remove_doc",id:e.post.id,_wpnonce:weDocs.nonce},success:function(){t.$remove(e),swal("Deleted!",o,"success")},error:function(e){alert(e)}})},toggleFaq:function(e){wp.ajax.send({data:{action:"wedocs_toggle_doc_faq",id:e.post.id,_wpnonce:weDocs.nonce},success:function(t){e.post.is_faq=t.is_faq},error:function(e){alert(e)}})},addFaqArticle:function(e,t){var o=t,n=this;this.categories=this.categories||[],swal({title:weDocs.enter_faq_title,type:"input",showCancelButton:!0,closeOnConfirm:!0,animation:"slide-from-top",inputPlaceholder:weDocs.write_something},function(t){return t===!1?!1:(wp.ajax.send({data:{action:"wedocs_create_faq_doc",title:t,category_id:e.category.id,category_order:e.child.length,category_all_order:n.categories[0].child.length,status:"draft",parent:-1,_wpnonce:weDocs.nonce},success:function(t){e.child.push(t),"-1"!=e.category.id&&n.categories[0].child.push(t);var s=jQuery(o.target).closest(".section-title").next();s.hasClass("collapsed")&&s.removeClass("collapsed")},error:function(e){alert(e)}}),void 0)})},toggleVisibility:function(e){var t=this;this.categories=this.categories||[],wp.ajax.send({data:{action:"wedocs_toggle_doc_visibility",id:e.post.id,_wpnonce:weDocs.nonce},success:function(o){e.post.status=o.status;for(var n=0;n<t.categories.length;n++)for(var s=0;s<t.categories[n].child.length;s++)e.post.id==t.categories[n].child[s].post.id&&(t.categories[n].child[s].post.status=o.status)},error:function(e){alert(e)}})},addCategory:function(){var e=this;this.categories=this.categories||[],swal({title:weDocs.enter_category_title,type:"input",showCancelButton:!0,closeOnConfirm:!0,animation:"slide-from-top",inputPlaceholder:weDocs.write_something},function(t){return t===!1?!1:(t=t.trim(),t&&wp.ajax.send({data:{action:"wedocs_create_category",title:t,order:e.categories.length,_wpnonce:weDocs.nonce},success:function(t){e.categories.push(t)},error:this.onError}),void 0)})},removeCategory:function(e,t){swal({title:"Are you sure?",text:"Heads up - it will NOT delete the actual posts. Are you sure to delete the category?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){wp.ajax.send({data:{action:"wedocs_remove_category",id:e.category.id,_wpnonce:weDocs.nonce},success:function(){t.$remove(e),swal("Deleted!","Category was successfully deleted.","success")},error:function(e){alert(e)}})})},removeFaqArticle:function(e){var t=this;this.categories=this.categories||[],swal({title:"Are you sure?",text:"Are you sure to delete the article?",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",closeOnConfirm:!1},function(){wp.ajax.send({data:{action:"wedocs_remove_doc",id:e.post.id,_wpnonce:weDocs.nonce},success:function(){for(var o=0;o<t.categories.length;o++)for(var n=0;n<t.categories[o].child.length;n++)if(e.post.id==t.categories[o].child[n].post.id){t.categories[o].child.$remove(t.categories[o].child[n]);break}swal("Deleted!","Article was successfully deleted.","success")},error:function(e){alert(e)}})})},toggleCollapse:function(e){jQuery(e.target).siblings("ul.articles").toggleClass("collapsed")}}});